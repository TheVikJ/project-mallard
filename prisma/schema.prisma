// If you update this file, run `npx prisma generate` after
// to update the Prisma library

datasource db {
  provider    = "postgresql"
  url         = env("DB_URL")
}

generator client {
  provider    = "prisma-client-js"
}

model user_types {
  id            Int             @id @default(autoincrement())
  user_type     String
  created_at    DateTime        @default(now())

  User          user[]
}

model user {
  username      String          @id
  first_name     String
  last_name     String
  password      String
  user_type_id  Int         
  created_at    DateTime        @default(now())

  UserType      user_types      @relation(fields: [user_type_id], references: [id])

  Sender        notifications[]  @relation("sender")
  Recipient     notifications[]  @relation("recipient")
  PolicyHolder  claim_notif[]   @relation("policy_holder")
  Claimant      claim_notif[]   @relation("claimant")
}

model notifications {
  id            Int             @id @default(autoincrement())
  sender        String
  recipient     String
  is_active     Boolean         @default(true)
  
  Sender        user            @relation("sender", fields: [sender], references: [username])
  Recipient     user            @relation("recipient", fields: [recipient], references: [username])

  PolicyNotif   policy_notif?
  ClaimNotif    claim_notif?
  NewsNotif     news_notif?
}

model policy_notif {
  id            Int             @id @default(autoincrement())
  notif_id      Int             @unique
  policy_id     Int
  subject       String
  body          String
  is_read       Boolean
  is_archived   Boolean
  
  Notification   notifications    @relation(fields: [notif_id], references: [id])
}

model claim_notif {
  id            Int             @id @default(autoincrement())
  notif_id      Int             @unique
  policy_holder String
  claimant      String
  type          String
  due_date      DateTime
  business      String
  description   String
  priority      Int
  is_completed  Boolean         @default(false)
  created_at    DateTime        @default(now())

  Notification   notifications    @relation(fields: [notif_id], references: [id])
  
  PolicyHolder  user            @relation("policy_holder", fields: [policy_holder], references: [username])
  Claimant      user            @relation("claimant", fields: [claimant], references: [username])
}

model news_notif {
  id            Int             @id @default(autoincrement())
  notif_id      Int             @unique
  title         String
  type          String
  created_on    DateTime        @default(now())  // creation of policy
  expires_on    DateTime
  created_at    DateTime        @default(now())  // creation of record in database

  Notification   notifications    @relation(fields: [notif_id], references: [id])
}
